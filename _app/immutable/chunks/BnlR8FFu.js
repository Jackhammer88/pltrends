import{g as i,w as c}from"./CZwMRGbe.js";import"./CicRNIZi.js";const l="https://bbaii2i41d3ecpiaumro.containers.yandexcloud.net/api/v1";class r{constructor(t,e){this.Code=t,this.Description=e}}async function p(){const n=i(u);console.log(n);const t={"Content-Type":"application/json"};n&&(t["X-Authorization"]=`Bearer ${n.access_token}`);const e=await fetch(`${l}/data/langs`,{method:"GET",headers:t});if(!e.ok){const o=await e.text();return new r(e.status,o||"Unknown error")}try{return(await e.json()).langs}catch{return new r(500,"Invalid JSON from server")}}async function g(n){const t=i(u),e={"Content-Type":"application/json"};t&&(e["X-Authorization"]=`Bearer ${t.access_token}`);const o=await fetch(`${l}/data/lang?lang=${encodeURIComponent(n)}`,{method:"GET",headers:e});if(!o.ok){const a=await o.text();return new r(o.status,a||"Unknown error")}try{const a=await o.blob();return await new Promise((f,h)=>{const s=new FileReader;s.onloadend=()=>f(s.result),s.onerror=h,s.readAsDataURL(a)})}catch{return new r(500,"Invalid JSON from server")}}class y{constructor(t,e,o=Date.now()+e*1e3){this.access_token=t,this.expires_in=e,this.expires_at=o}isExpired(){return Date.now()>this.expires_at}}async function m(n){i(u);const t=await fetch(`${l}/auth/exchange`,{method:"POST",body:JSON.stringify({code:n})});if(!t.ok){const e=await t.text();return new r(t.status,e||"Unknown error")}try{const e=await t.json();return new y(e.access_token,Number(e.expires_in))}catch{return new r(500,"Invalid JSON from server")}}const u=c(null),d=c([]),w=c({});async function b(){let n=!1;if(d.update(e=>(n=e.length>0,e)),n)return;let t=await p();Array.isArray(t)?d.set(t):console.error("API error:",t.Code,t.Description)}async function A(n){const t=i(w);if(t[n])return t[n];const e=await g(n);return typeof e=="string"?(w.update(o=>({...o,[n]:e})),e):(console.error("Failed to load lang stats:",e),null)}export{r as A,l as B,y as T,d as a,A as b,m as e,u as g,b as l};
