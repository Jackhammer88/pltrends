import{O as i,a3 as l}from"./19A5uAuV.js";import"./DER0jAAv.js";const u="https://bbaii2i41d3ecpiaumro.containers.yandexcloud.net/api/v1";let a=class{constructor(e,t){this.Code=e,this.Description=t}};async function y(){const n=i(d),e={"Content-Type":"application/json"};n&&(e["X-Authorization"]=`Bearer ${n.access_token}`);const t=await fetch(`${u}/data/langs`,{method:"GET",headers:e});if(!t.ok){const r=await t.text();return new a(t.status,r||"Unknown error")}try{return(await t.json()).langs.map((o,c)=>({Id:c,Name:o}))}catch{return new a(500,"Invalid JSON from server")}}async function g(n){const e=i(d),t={"Content-Type":"application/json"};e&&(t["X-Authorization"]=`Bearer ${e.access_token}`);const r=await fetch(`${u}/data/lang?lang=${encodeURIComponent(n)}`,{method:"GET",headers:t});if(!r.ok){const o=await r.text();return new a(r.status,o||"Unknown error")}try{const o=await r.blob();return await new Promise((c,f)=>{const s=new FileReader;s.onloadend=()=>c(s.result),s.onerror=f,s.readAsDataURL(o)})}catch{return new a(500,"Invalid JSON from server")}}const d=l(null),h=l([]),p=l({});async function b(){let n=!1;if(h.update(t=>(n=t.length>0,t)),n)return;const e=await y();Array.isArray(e)?h.set(e):console.error("API error:",e.Code,e.Description)}async function T(n){const e=i(p);if(e[n])return e[n];const t=await g(n);return typeof t=="string"?(p.update(r=>({...r,[n]:t})),t):(console.error("Failed to load lang stats:",t),null)}class w{constructor(e,t){this.Code=e,this.Description=t}}class m{constructor(e,t,r=Date.now()+t*1e3){this.access_token=e,this.expires_in=t,this.expires_at=r}isExpired(){return Date.now()>this.expires_at}}async function _(n){i(d);const e=await fetch(`${u}/auth/exchange`,{method:"POST",body:JSON.stringify({code:n})});if(!e.ok){const t=await e.text();return new w(e.status,t||"Unknown error")}try{const t=await e.json();return new m(t.access_token,Number(t.expires_in))}catch{return new w(500,"Invalid JSON from server")}}export{a as A,u as B,m as T,h as a,T as b,_ as e,d as g,b as l};
